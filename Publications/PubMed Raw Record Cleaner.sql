#### PARSE PUBMED SUMMARY OUTPUT
##DROP table work.pubmed_raw;
##select * from work.pubmed_raw;
############################################
##########  ADD COLUMNS TO RAW PUBMED OUTPUT
#############################################


Alter table work.pubmed_raw
ADD Citation varchar(4000),
ADD PMID varchar(12),
ADD PMCID varchar(12);

SET SQL_SAFE_UPDATES = 0;

## REMOVE LEADING NUMBER FROM PUBMED OUTPUT
UPDATE work.pubmed_raw
SET Citation=SUBSTR(Raw, LOCATE(":",RAW)+2, CHAR_LENGTH(Raw)-(LOCATE(":",RAW)+2));

## EXTRACT PMID
UPDATE work.pubmed_raw
SET PMID=SUBSTR(Raw, LOCATE("PMID:",RAW)+6, 8)
WHERE substr(raw,LOCATE("PMID:",RAW)+6,1)<>" ";

## To handle cases with 2 spaces after PMID:
UPDATE work.pubmed_raw
SET PMID=SUBSTR(Raw, LOCATE("PMID:",RAW)+7, 8)
WHERE substr(raw,LOCATE("PMID:",RAW)+6,1)=" ";



## EXTRACT PMCID
UPDATE work.pubmed_raw
SET PMCID=SUBSTR(Raw, LOCATE("PMCID:",RAW)+7, 10)
WHERE LOCATE("PMCID:",RAW)>0;

SET SQL_SAFE_UPDATES = 1;


##### MAKE Pubmed Output file
DROP TABLE IF EXISTS work.PubmedOUT;
create table work.PubmedOUT as
select PMID,PMCID,Citation from 
work.pubmed_raw
order by PMID;

##############################
### UPDATE Pub_CORE

SET SQL_SAFE_UPDATES = 0;
UPDATE pubs.PUB_CORE pc, work.PubmedOUT lu
SET pc.PMC=lu.PMCID,
    pc.NIHMS_Status='PMC Compliant'
WHERE pc.PMID=lu.PMID
AND lu.PMCID IS NOT NULL;
SET SQL_SAFE_UPDATES = 0;


###########################################
############# END OF FILE #################
###########################################
###########################################

select distinct PMID from pubs.PUB_CORE;

drop table if exists work.temp;
CREATE TABLE work.temp as
select distinct Employee_ID,Name,Salary_Plan,Job_Code,Department,Department_Code from lookup.Employees
WHERE Department like 'JX%'
AND Salary_Plan LIKE '%Faculty%';


drop table if exists work.temp;
CREATE TABLE work.temp as
select  CLK_AWD_PI,
SUM(SPONSOR_AUTHORIZED_AMOUNT) TotalAmount
 from lookup.awards_history
WHERE CLK_PI_UFID in
('42736169',
'12115006',
'25415111',
'78883621',
'13534081',
'85635815',
'91921857',
'96360788',
'60153371',
'36999815',
'74479221',
'99388915',
'71629340',
'66289810',
'11896196',
'67388395',
'66100021',
'69064381',
'95427400',
'60595917',
'51311951',
'61159336',
'78981128',
'46760493',
'19544281',
'39389961',
'73700761',
'44490857',
'84250240',
'46998394',
'60388451',
'34648860',
'19373283',
'03046681',
'07524721',
'50745130',
'99572150',
'73364341',
'51104917',
'86931330',
'55955709',
'71661715',
'89751839',
'96321954',
'19570420',
'48339805',
'91634029',
'49534699',
'17640790',
'38373678',
'76420346',
'29787779',
'54829874',
'98758297',
'87131070',
'68026560',
'56516697',
'42899641',
'67108940',
'12133936',
'16869115',
'10961919',
'80825890',
'36999456',
'36472670',
'09143374',
'43971568',
'26386921',
'78581600',
'92860104',
'23160540',
'51586575',
'47698165',
'84898061',
'60748460',
'96161882',
'26286000',
'42881708',
'69267640',
'50075128',
'10439937',
'93599949',
'56663979',
'43363816',
'12332103',
'25274135',
'99855479',
'81130935',
'98043316',
'95685535',
'95874923',
'85171758',
'01106879',
'84911398',
'45499400',
'86162170',
'78611939',
'43316060',
'28818979',
'26541799',
'02575547',
'03337741',
'38595901',
'67300260',
'27663949',
'75809550',
'39331769',
'24879441',
'63167175',
'92930718',
'67300260',
'05013899',
'07014841',
'42899360',
'94436792',
'53312973',
'57596281',
'22918438',
'21515993',
'75714330',
'18768195',
'15652981',
'32304460',
'21912956',
'66441706',
'46561600',
'11918887',
'98351764',
'42142161',
'33313743',
'78871300',
'36048093',
'43513680',
'23553601',
'74161591',
'97369348',
'36135850',
'98848985',
'62379536',
'08549700',
'79910546',
'93912678',
'91330068',
'88191516',
'26977570',
'99433954',
'99418170',
'14181511',
'34914691',
'31102681',
'86180306',
'95971909',
'32089090',
'13521460',
'19097567',
'40145034',
'39893220',
'05568930',
'08945103',
'07569561',
'59693645',
'25959989',
'81114323',
'64817970',
'07955580',
'98464600',
'71948017',
'84912445',
'17261396',
'31676934',
'18449841',
'10151914',
'98790829',
'25188430',
'12531950',
'69198981',
'69986281',
'22311000',
'61653658',
'71830290',
'14274961',
'26253361',
'46868030',
'48061441',
'03533461',
'80512020',
'39650149',
'18218913',
'18841470',
'67394019',
'83948008',
'61692829',
'85258196',
'79676029',
'19129321',
'55635109',
'39102151',
'51069396',
'91196885',
'35365860',
'94102125',
'37338313',
'36913680',
'98563172',
'90276958',
'37643146',
'98856488',
'83671470',
'58266398',
'72715540',
'79201415',
'19332229',
'58060195',
'07117896',
'71337070',
'18451485',
'25317601',
'98344490',
'84464969',
'32591558',
'63142891',
'61931519',
'12671198',
'98099653',
'16897441',
'13883719',
'13545421',
'96112802',
'47148501',
'95481175',
'02331841',
'93921458',
'39414481',
'65514760',
'24654650',
'79461211',
'10655401',
'50781781',
'10172821',
'35544783',
'78217680',
'11077201',
'59565701',
'18854368',
'48516939',
'53633649',
'67675010',
'19170262',
'29604249',
'26619719',
'70151117',
'99510021',
'56056346',
'57452151',
'78839060',
'00241910',
'97951729',
'15315407',
'03306740',
'16454947',
'25396710',
'73137128',
'12051930',
'79164131',
'92441100',
'34982143',
'69391539',
'75691715',
'71935032',
'71359898',
'04411852',
'16244761',
'08745080',
'74167970',
'49495814',
'15623159',
'13954681',
'79214680',
'10168651',
'21435121',
'37133881',
'37770181',
'94568883',
'40254210',
'33196574',
'84113240',
'45190142',
'36652205',
'80037170',
'38954350',
'06595065',
'96047613',
'97523520',
'22544813',
'21112991',
'13736690',
'08284443',
'95968545',
'75717099',
'88011163',
'13469968',
'54418453',
'86786121',
'05989633',
'20099408',
'04846243',
'29638695',
'11250170',
'01891876',
'85059871',
'44790248',
'51942959',
'15174116',
'12687781',
'30947700',
'28779241',
'40876041',
'57955871',
'40663980',
'81514318',
'89101529',
'61146326',
'62197919',
'39019138',
'61958970',
'02441924',
'61729101',
'06158881',
'33616893',
'11871771',
'91979424',
'06797972',
'34718439',
'19411701',
'52786861',
'39941838',
'62760700',
'14333530',
'12935330',
'13536601',
'95108939',
'73175260',
'99646300',
'11974810',
'97913553',
'53490823',
'20696973',
'59161600',
'06936358',
'82411380',
'95007047',
'87198418',
'60152030',
'88392850',
'15120001',
'46290635',
'62559444',
'32297033',
'38103241',
'01852621',
'16739519',
'49162628',
'59561094',
'01111128',
'34762981',
'09578413',
'03174146',
'73715310',
'11739973',
'80835150',
'60603300',
'87136439',
'34857730',
'78937038',
'11848009',
'56339679',
'97671526',
'08946569',
'25619420',
'50571374',
'72153440',
'19338901',
'06421630',
'69373066',
'78199040',
'48829201',
'69667869',
'62563570',
'64375060',
'61417235',
'39650858',
'88059430',
'98054370',
'19834090',
'65003939',
'11641986',
'91959833',
'24001989',
'69972370',
'79018910',
'69693866',
'81688130',
'19206935',
'94167330',
'86953185',
'46328113',
'09163380',
'90990250',
'31544330',
'53319646',
'62014880',
'53936262',
'08083090',
'92135690',
'71458500',
'23613840',
'11167175',
'61003461',
'09193212',
'33862339',
'18229430',
'37896109',
'51295121',
'74436300',
'59351461',
'83961381',
'16899859',
'37646688',
'65934180',
'40230121',
'62196029',
'02725381',
'93195950',
'61950421',
'66190866',
'80949975',
'13989239',
'46598963',
'60886740',
'33101199',
'73809460',
'59088700',
'45491495',
'41096856',
'63193997',
'85489270',
'55639044',
'05257141',
'98369933',
'35989605',
'29856960',
'98113418',
'63486240',
'94196829',
'80354270',
'90902120',
'89839541',
'36349985',
'71221921',
'33065691',
'19887126',
'92222120',
'59190998',
'07752850',
'18171505',
'85113242',
'61031930',
'01830690',
'89892891',
'31158989',
'51464330',
'45051690',
'14328840',
'18380620',
'20605560',
'42079590',
'05859421',
'24022270',
'31915102',
'97990790',
'70563410',
'31667143',
'16586985',
'14549194',
'15717973',
'14913922',
'12161548',
'12191116',
'11313521',
'64760650',
'80529155',
'49518924',
'91189665',
'45034921',
'39839020',
'31008689',
'10212750',
'10646913',
'66940136',
'82934061',
'97549660',
'79326460',
'35694139',
'92433578',
'01105421',
'53134637',
'91536842',
'04771443',
'13299199',
'31658857',
'11248673'
) 

and  Year(FUNDS_ACTIVATED)>=2017
GROUP BY CLK_AWD_PI;
;




drop table if exists work.temp;
CREATE TABLE work.temp as
select  YEAR(FUNDS_ACTIVATED) AS Year ,
        CLK_AWD_ID,
		CLK_PI_UFID,
CLK_AWD_PI,
CLK_AWD_PROJ_NAME,
REPORTING_SPONSOR_NAME,
REPORTING_SPONSOR_AWD_ID,
DIRECT_AMOUNT,
INDIRECT_AMOUNT,
SPONSOR_AUTHORIZED_AMOUNT,
FUNDS_ACTIVATED,
CLK_AWD_PI_DEPT,
CLK_AWD_COLLEGE,
CLK_AWD_SPONSOR_NAME,
CLK_AWD_SPONSOR_AWD_ID,
CLK_AWD_PROJ_ID,
CLK_AWD_PROJ_MGR
 from lookup.awards_history
WHERE CLK_PI_UFID in
('42736169',
'12115006',
'25415111',
'78883621',
'13534081',
'85635815',
'91921857',
'96360788',
'60153371',
'36999815',
'74479221',
'99388915',
'71629340',
'66289810',
'11896196',
'67388395',
'66100021',
'69064381',
'95427400',
'60595917',
'51311951',
'61159336',
'78981128',
'46760493',
'19544281',
'39389961',
'73700761',
'44490857',
'84250240',
'46998394',
'60388451',
'34648860',
'19373283',
'03046681',
'07524721',
'50745130',
'99572150',
'73364341',
'51104917',
'86931330',
'55955709',
'71661715',
'89751839',
'96321954',
'19570420',
'48339805',
'91634029',
'49534699',
'17640790',
'38373678',
'76420346',
'29787779',
'54829874',
'98758297',
'87131070',
'68026560',
'56516697',
'42899641',
'67108940',
'12133936',
'16869115',
'10961919',
'80825890',
'36999456',
'36472670',
'09143374',
'43971568',
'26386921',
'78581600',
'92860104',
'23160540',
'51586575',
'47698165',
'84898061',
'60748460',
'96161882',
'26286000',
'42881708',
'69267640',
'50075128',
'10439937',
'93599949',
'56663979',
'43363816',
'12332103',
'25274135',
'99855479',
'81130935',
'98043316',
'95685535',
'95874923',
'85171758',
'01106879',
'84911398',
'45499400',
'86162170',
'78611939',
'43316060',
'28818979',
'26541799',
'02575547',
'03337741',
'38595901',
'67300260',
'27663949',
'75809550',
'39331769',
'24879441',
'63167175',
'92930718',
'67300260',
'05013899',
'07014841',
'42899360',
'94436792',
'53312973',
'57596281',
'22918438',
'21515993',
'75714330',
'18768195',
'15652981',
'32304460',
'21912956',
'66441706',
'46561600',
'11918887',
'98351764',
'42142161',
'33313743',
'78871300',
'36048093',
'43513680',
'23553601',
'74161591',
'97369348',
'36135850',
'98848985',
'62379536',
'08549700',
'79910546',
'93912678',
'91330068',
'88191516',
'26977570',
'99433954',
'99418170',
'14181511',
'34914691',
'31102681',
'86180306',
'95971909',
'32089090',
'13521460',
'19097567',
'40145034',
'39893220',
'05568930',
'08945103',
'07569561',
'59693645',
'25959989',
'81114323',
'64817970',
'07955580',
'98464600',
'71948017',
'84912445',
'17261396',
'31676934',
'18449841',
'10151914',
'98790829',
'25188430',
'12531950',
'69198981',
'69986281',
'22311000',
'61653658',
'71830290',
'14274961',
'26253361',
'46868030',
'48061441',
'03533461',
'80512020',
'39650149',
'18218913',
'18841470',
'67394019',
'83948008',
'61692829',
'85258196',
'79676029',
'19129321',
'55635109',
'39102151',
'51069396',
'91196885',
'35365860',
'94102125',
'37338313',
'36913680',
'98563172',
'90276958',
'37643146',
'98856488',
'83671470',
'58266398',
'72715540',
'79201415',
'19332229',
'58060195',
'07117896',
'71337070',
'18451485',
'25317601',
'98344490',
'84464969',
'32591558',
'63142891',
'61931519',
'12671198',
'98099653',
'16897441',
'13883719',
'13545421',
'96112802',
'47148501',
'95481175',
'02331841',
'93921458',
'39414481',
'65514760',
'24654650',
'79461211',
'10655401',
'50781781',
'10172821',
'35544783',
'78217680',
'11077201',
'59565701',
'18854368',
'48516939',
'53633649',
'67675010',
'19170262',
'29604249',
'26619719',
'70151117',
'99510021',
'56056346',
'57452151',
'78839060',
'00241910',
'97951729',
'15315407',
'03306740',
'16454947',
'25396710',
'73137128',
'12051930',
'79164131',
'92441100',
'34982143',
'69391539',
'75691715',
'71935032',
'71359898',
'04411852',
'16244761',
'08745080',
'74167970',
'49495814',
'15623159',
'13954681',
'79214680',
'10168651',
'21435121',
'37133881',
'37770181',
'94568883',
'40254210',
'33196574',
'84113240',
'45190142',
'36652205',
'80037170',
'38954350',
'06595065',
'96047613',
'97523520',
'22544813',
'21112991',
'13736690',
'08284443',
'95968545',
'75717099',
'88011163',
'13469968',
'54418453',
'86786121',
'05989633',
'20099408',
'04846243',
'29638695',
'11250170',
'01891876',
'85059871',
'44790248',
'51942959',
'15174116',
'12687781',
'30947700',
'28779241',
'40876041',
'57955871',
'40663980',
'81514318',
'89101529',
'61146326',
'62197919',
'39019138',
'61958970',
'02441924',
'61729101',
'06158881',
'33616893',
'11871771',
'91979424',
'06797972',
'34718439',
'19411701',
'52786861',
'39941838',
'62760700',
'14333530',
'12935330',
'13536601',
'95108939',
'73175260',
'99646300',
'11974810',
'97913553',
'53490823',
'20696973',
'59161600',
'06936358',
'82411380',
'95007047',
'87198418',
'60152030',
'88392850',
'15120001',
'46290635',
'62559444',
'32297033',
'38103241',
'01852621',
'16739519',
'49162628',
'59561094',
'01111128',
'34762981',
'09578413',
'03174146',
'73715310',
'11739973',
'80835150',
'60603300',
'87136439',
'34857730',
'78937038',
'11848009',
'56339679',
'97671526',
'08946569',
'25619420',
'50571374',
'72153440',
'19338901',
'06421630',
'69373066',
'78199040',
'48829201',
'69667869',
'62563570',
'64375060',
'61417235',
'39650858',
'88059430',
'98054370',
'19834090',
'65003939',
'11641986',
'91959833',
'24001989',
'69972370',
'79018910',
'69693866',
'81688130',
'19206935',
'94167330',
'86953185',
'46328113',
'09163380',
'90990250',
'31544330',
'53319646',
'62014880',
'53936262',
'08083090',
'92135690',
'71458500',
'23613840',
'11167175',
'61003461',
'09193212',
'33862339',
'18229430',
'37896109',
'51295121',
'74436300',
'59351461',
'83961381',
'16899859',
'37646688',
'65934180',
'40230121',
'62196029',
'02725381',
'93195950',
'61950421',
'66190866',
'80949975',
'13989239',
'46598963',
'60886740',
'33101199',
'73809460',
'59088700',
'45491495',
'41096856',
'63193997',
'85489270',
'55639044',
'05257141',
'98369933',
'35989605',
'29856960',
'98113418',
'63486240',
'94196829',
'80354270',
'90902120',
'89839541',
'36349985',
'71221921',
'33065691',
'19887126',
'92222120',
'59190998',
'07752850',
'18171505',
'85113242',
'61031930',
'01830690',
'89892891',
'31158989',
'51464330',
'45051690',
'14328840',
'18380620',
'20605560',
'42079590',
'05859421',
'24022270',
'31915102',
'97990790',
'70563410',
'31667143',
'16586985',
'14549194',
'15717973',
'14913922',
'12161548',
'12191116',
'11313521',
'64760650',
'80529155',
'49518924',
'91189665',
'45034921',
'39839020',
'31008689',
'10212750',
'10646913',
'66940136',
'82934061',
'97549660',
'79326460',
'35694139',
'92433578',
'01105421',
'53134637',
'91536842',
'04771443',
'13299199',
'31658857',
'11248673'
) 

and Year(FUNDS_ACTIVATED)>=2017
;